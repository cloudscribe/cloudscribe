function doCountdownPromise(e, n, t, o) { n = 1e3 * n || 1e4; var i = new Date, r = function (a, u) { var s = Number(e) - Number(new Date - Number(i)) / 1e3; if (t > 0 && s > t && ($("#sessionExpiryWarning").modal("hide"), o = !1), t > 0 && s <= t) { let t = $("#sessionExpiryWarning"); if (null != t && parseInt(s) >= 0 && $("#sessionExpiryWarningSeconds").text(parseInt(s)), !o) { var m = n; n = 1e3, $("#sessionExpiryWarning").modal("show"), $("#sessionKeepAlive").off(), $("#sessionKeepAlive").click((() => { let o = $("#sessionExpiryWarning")[0].dataset.urlKeepAlive; o = o + "?t=" + Math.random(), pollForKeepAlive(getRemainingTimePromise, o, 5e3, 800).then((function (r) { Number(r) - Number(s) > 10 ? (e = r, i = new Date, n = m, t.hide()) : pollForKeepAlive(getRemainingTimePromise, o, 5e3, 800).then((function (o) { Number(o) - Number(s) > 10 && (e = o, i = new Date, n = m, t.hide()) })).catch((function () { })) })).catch((function () { })) })), hookupLogoutButton(), o = !0 } } s < -2 ? a() : setTimeout(r, n, a, u) }; return new Promise(r) } function getRemainingTimePromise(e) { return $.ajax({ url: e }) } function pollForKeepAlive(e, n, t, o) { var i = Number(new Date) + (t || 5e3), r = function (t, a) { var u = e(n); u ? t(u) : Number(new Date) < i ? setTimeout(r, o, t, a) : a(new Error("session checker timed out")) }; return new Promise(r) } function btnManualLogout(e) { var n = document.getElementById("logoutForm"); n && n.submit(), e.preventDefault() } function hookupLogoutButton() { var e = document.getElementById("btnSessionLogOut"); e && e.addEventListener("click", btnManualLogout, !1) } window.addEventListener("DOMContentLoaded", (() => { let e = $("#sessionExpiry")[0], n = e.dataset.urlKeepAlive, t = e.dataset.urlTarget, o = Number(e.dataset.alertThreshold) || 60, i = Number(e.dataset.pollingInterval) || 5; var r = Number(e.dataset.secondsLeft) || Number(getRemainingTimePromise(n)) || 0; window.location.href == t && btnManualLogout(), r > 0 && doCountdownPromise(r, i, o, !1).then((function () { window.location.href = t })).catch((function () { })) }));