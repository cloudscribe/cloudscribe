function doCountdownPromise(e, n, t, o) { n = 1e3 * n || 1e4; var i = new Date, a = function (r, s) { var u = Number(e) - Number(new Date - Number(i)) / 1e3; if (t > 0 && u > t && ($("#sessionExpiryWarning").hide(), o = !1), t > 0 && u <= t) { let l = $("#sessionExpiryWarning"); if (null != l && parseInt(u) >= 0 && $("#sessionExpiryWarningSeconds").text(parseInt(u)), !o) { var c = n; n = 1e3, l.show(), $("#sessionKeepAlive").off(), $("#sessionKeepAlive").click(() => { let t = $("#sessionExpiryWarning")[0].dataset.urlKeepAlive; pollForKeepAlive(getRemainingTimePromise, t = t + "?t=" + Math.random(), 5e3, 800).then(function (o) { Number(o) - Number(u) > 10 ? (e = o, i = new Date, n = c, l.hide()) : pollForKeepAlive(getRemainingTimePromise, t, 5e3, 800).then(function (t) { Number(t) - Number(u) > 10 && (e = t, i = new Date, n = c, l.hide()) }).catch(function () { }) }).catch(function () { }) }), hookupLogoutButton(), o = !0 } } u < -2 ? r() : setTimeout(a, n, r, s) }; return new Promise(a) } function getRemainingTimePromise(e) { return $.ajax({ url: e }) } function pollForKeepAlive(e, n, t, o) { var i = Number(new Date) + (t || 5e3), a = function (t, r) { var s = e(n); s ? t(s) : Number(new Date) < i ? setTimeout(a, o, t, r) : r(Error("session checker timed out")) }; return new Promise(a) } function btnManualLogout(e) { var n = document.getElementById("logoutForm"); n && n.submit(), e.preventDefault() } function hookupLogoutButton() { var e = document.getElementById("btnSessionLogOut"); e && e.addEventListener("click", btnManualLogout, !1) } window.addEventListener("DOMContentLoaded", () => { let e = $("#sessionExpiry")[0], n = e.dataset.urlTarget, t = Number(e.dataset.alertThreshold) || 60, o = Number(e.dataset.pollingInterval) || 5; var i = Number(e.dataset.secondsLeft) || Number(getRemainingTime(source)) || 0; window.location.href == n && btnManualLogout(), i > 0 && doCountdownPromise(i, o, t, !1).then(function () { window.location.href = n }).catch(function () { }) });